@namespace Masa.Stack.Components.GlobalNavigations

<MExpansionPanel Class="app"
                 Id="@App.TagId(CategoryCode)"
                 Value="@App.Code">
    <MExpansionPanelHeader Class="masa-text-highlight-1" Ripple="false">
        @if (Checkable)
        {
            <MSimpleCheckbox
                Color="primary"
                Ripple="false"
                Value="@AppChecked"
                ValueChanged="@AppCheckedChanged"
                Class="masa-icon-size-20"
                Style="flex: none;margin-right: -4px;">
            </MSimpleCheckbox>
        }
        <span style="flex:none">
            @App.Name
        </span>
        @if (!context && App.RoutableNavsCount > 0)
        {
            <span class="masa-text-3-1 ml-1">@App.RoutableNavsCount</span>
        }
    </MExpansionPanelHeader>
    <MExpansionPanelContent>
        @foreach (var nav in App.Navs)
        {
            <MCard @key="nav" Class="nav" Outlined>
                <MList Dense Class="pa-0">
                    <MListItemGroup Values="_values" ValuesChanged="ValuesChanged" Multiple>
                        <ExpansionAppItem Data="nav"
                                          Level="1"
                                          Checkable="Checkable"
                                          ToggleFavorite="() => ToggleFavorite(CategoryCode, App.Code, nav)">
                        </ExpansionAppItem>

                        @if (nav.HasChildren)
                        {
                            @foreach (var subNav in nav.Children)
                            {
                                <ExpansionAppItem Data="subNav"
                                                  Checkable="Checkable"
                                                  Level="2"
                                                  ToggleFavorite="() => ToggleFavorite(CategoryCode, App.Code, subNav)">
                                </ExpansionAppItem>

                                if (Checkable && subNav.HasActions)
                                {
                                    foreach (var action in subNav.Actions)
                                    {
                                        <ExpansionAppItem Data="action"
                                                          Checkable="Checkable"
                                                          Level="3">
                                        </ExpansionAppItem>
                                    }
                                }
                            }
                        }
                        else if (Checkable && nav.HasActions)
                        {
                            @foreach (var action in nav.Actions)
                            {
                                <ExpansionAppItem Data="action"
                                                  Checkable="Checkable"
                                                  Level="3">
                                </ExpansionAppItem>
                            }
                        }
                    </MListItemGroup>
                </MList>
            </MCard>
        }
    </MExpansionPanelContent>
</MExpansionPanel>
