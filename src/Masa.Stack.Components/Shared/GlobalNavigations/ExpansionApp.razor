@namespace Masa.Stack.Components.GlobalNavigations
@inherits MasaComponentBase

<div Class="app"
     Id="@App.TagId(CategoryCode, ExpansionWrapper?.TagIdPrefix)"
     Value="@App.Code"
     Readonly="InPreview">
    <MHover Disabled="!Checkable" Class="masa-text-highlight-1 mb-0 d-flex justify-space-between">
        <div @attributes="@context.Attrs">
            <span class="masa-text-2-2">
                @TranslateProvider.DT(App.Name) 
            </span>
            @if (Checkable && context.Hover)
            {
                if ((AppChecked && InPreview) || !InPreview)
                {
                    <div class="d-flex">
                        <span class="masa-text-3-1">@T("SelectAll")</span>
                        <MSimpleCheckbox Color="primary"
                                 Ripple="false"
                                 Value="@AppChecked"
                                 ValueChanged="@AppCheckedChanged"
                                 Class="masa-icon-size-20"
                                 Style="flex: none;margin-right: -4px;"
                                 Readonly="InPreview">
                        </MSimpleCheckbox>
                    </div>
                }
            }
        </div>
    </MHover>
    <div Class="mt-4">
        @foreach (var nav in App.Navs.Where(nav => Filter(nav)))
        {
            <MCard @key="nav" Class="nav" Outlined>
                <MList Dense Class="pa-0">
                    <MListItemGroup Values="_values" Multiple>
                        <CascadingValue Value="this">
                            <ExpansionAppItem Data="nav"
                                          Level="1"
                                          Checkable="Checkable"
                                          InPreview="InPreview"
                                          ToggleFavorite="() => ToggleFavorite(CategoryCode, App.Code, nav)">
                            </ExpansionAppItem>
                            @if (nav.Children.Any(c=>!c.Hiden))
                            {
                                <div class="mx-4" style="border: 1px dashed #E4E8F3;"></div>
                            }
                            @if (nav.HasChildren)
                            {
                                foreach (var subNav in nav.Children.Where(subNav => Filter(subNav)))
                                {
                                    <ExpansionAppItem Data="@subNav"
                                          Checkable="@Checkable"
                                          InPreview="InPreview"
                                          Level="2"
                                          ToggleFavorite="@(() => ToggleFavorite(CategoryCode, App.Code, subNav))">
                                    </ExpansionAppItem>

                                    if (subNav.HasActions)
                                    {
                                        @foreach (var action in subNav.Actions!.Where(action => Filter(action)))
                                        {
                                            <ExpansionAppItem Data="@action"
                                                NavCode="@subNav.Code"
                                                Checkable="@Checkable"
                                                InPreview="InPreview"
                                                Level="3">
                                            </ExpansionAppItem>
                                        }
                                    }
                                }
                            }
                            else if (nav.HasActions)
                            {
                                @foreach (var action in nav.Actions!.Where(action => Filter(action)))
                                {
                                    <ExpansionAppItem Data="@action"
                                          NavCode="@nav.Code"
                                          Checkable="@Checkable"
                                          InPreview="InPreview"
                                          Level="3">
                                    </ExpansionAppItem>
                                }
                            }
                        </CascadingValue>
                    </MListItemGroup>
                </MList>
            </MCard>
        }
    </div>
</div>
