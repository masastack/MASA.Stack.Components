@using FluentValidation
@using Masa.Stack.Components.Logins
@using Masa.Stack.Components.Forms
@namespace Masa.Stack.Components
@inherits MasaComponentBase

<SDefaultSheet>
    <SlideXTransition LeaveAbsolute>
        <ShowTransitionElement Value="(_key == 0)">
            <STabSheets @bind-Value="_value" Tabs="@Tabs" OnChange="ResetFields">
                <MTabItem Value="Tabs[0]">
                    <PhoneNumberValidateForm @ref="_phoneNumberValidateForm"></PhoneNumberValidateForm>
                </MTabItem>
                <MTabItem Value="Tabs[1]" Disabled>
                    <EmailValidateForm @ref="_emailValidateForm"></EmailValidateForm>
                </MTabItem>
            </STabSheets>
        </ShowTransitionElement>
    </SlideXTransition>
    <SlideXReverseTransition LeaveAbsolute>
        <ShowTransitionElement Value="(_key == 1)">
            <SSetPasswordSheet Account="@Account" OnBack="HandleOnBack"></SSetPasswordSheet>
        </ShowTransitionElement>
    </SlideXReverseTransition>
</SDefaultSheet>

@code {

    private PhoneNumberValidateForm? _phoneNumberValidateForm;
    private EmailValidateForm? _emailValidateForm;

    private StringNumber _key = 0;

    private string? Account { get; set; }

    private List<string> Tabs => new List<string>() { T("SetPasswordBySMS"), T("SetPasswordByEmail") };

    private string _value ="";

    protected override void OnInitialized()
    {
        _value = T("SetPasswordBySMS");
    }

    private void HandleOnBack()
    {
        _key = 0;

        ResetFields();
    }

    internal void ResetFields()
    {
        _phoneNumberValidateForm?.ResetFields();
        _emailValidateForm?.ResetFields();
    }

}
